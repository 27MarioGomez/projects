<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8"/>
  <title>Sazoom – ¿Qué cocino hoy?</title>
  <style>
    body { font-family:sans-serif; max-width:800px; margin:auto; padding:1rem; }
    form { display:grid; gap:.5rem; margin-bottom:1rem; }
    .tooltip { position:relative; cursor:help; color:#888; }
    .tooltip .tooltiptext {
      visibility:hidden; width:200px; background:#333; color:#fff;
      border-radius:4px; padding:5px;
      position:absolute; bottom:125%; left:50%; transform:translateX(-50%);
      opacity:0; transition:.3s; z-index:1;
    }
    .tooltip:hover .tooltiptext { visibility:visible; opacity:1; }
    .grid { display:grid; gap:1rem; grid-template-columns:repeat(auto-fill,minmax(200px,1fr)); }
    .card { border:1px solid #ddd; border-radius:8px; overflow:hidden; }
    .card img { width:100%; height:120px; object-fit:cover; }
    .card-content { padding:.5rem; }
    .btn { display:block; width:100%; background:#28a745; color:#fff;
           padding:.6rem; border:none; border-radius:4px; cursor:pointer; text-align:center; }
  </style>
</head>
<body>
  <h1>Sazoom</h1>
  <p>Busca recetas por ingredientes y filtra por dieta o alérgenos.</p>
  <form id="searchForm" action="/recipes">
    <div>
      <label>Ingredientes
        <span class="tooltip">?
          <span class="tooltiptext">Ej. tomate,pollo,lechuga</span>
        </span>
      </label>
      <input name="ingredients" required style="width:100%" placeholder="p.ej. tomate,pollo,lechuga"/>
    </div>
    <div>
      <label>Dieta
        <span class="tooltip">?
          <span class="tooltiptext">Opcional: keto, vegan (en inglés)</span>
        </span>
      </label>
      <input name="diet" style="width:100%" placeholder="p.ej. keto"/>
    </div>
    <div>
      <label>Alérgenos
        <span class="tooltip">?
          <span class="tooltiptext">Opcional: gluten-free, peanut-free (en inglés)</span>
        </span>
      </label>
      <input name="health" style="width:100%" placeholder="p.ej. gluten-free"/>
    </div>
    <div>
      <label>Nº resultados</label>
      <input type="number" name="number" min="1" max="30" value="10" style="width:100%"/>
    </div>
    <button type="submit" class="btn">Buscar</button>
  </form>

  <div id="results" class="grid">
    <!-- Se llena en servidor -->
    {% for r in request.url.include_query %}{% endfor %}
  </div>

  <script>
    // Simplemente dejamos que FastAPI devuelva JSON; 
    // mejor usar JS para fetch y mostrar tarjetas dinamicamente.
    const form = document.getElementById('searchForm');
    const results = document.getElementById('results');

    form.addEventListener('submit', async e => {
      e.preventDefault();
      results.innerHTML = '<p>Cargando…</p>';
      const q = new URLSearchParams(new FormData(form));
      const res = await fetch(`/recipes?${q}`);
      const list = await res.json();
      results.innerHTML = list.length
        ? list.map(r=>`
          <div class="card">
            <img src="${r.image}" alt="${r.title}"/>
            <div class="card-content">
              <h4>${r.title}</h4>
              <button class="btn" onclick="location.href='/recipe/${r.id}'">
                Ver receta completa
              </button>
            </div>
          </div>`).join('')
        : '<p>No hay resultados.</p>';
    });
  </script>
</body>
</html>
