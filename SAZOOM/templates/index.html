<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8"/>
  <title>Sazoom – ¿Qué cocino hoy?</title>
  <style>
    body { font-family:sans-serif; max-width:800px; margin:auto; padding:1rem; }
    .field { margin-bottom:1rem; }
    label { font-weight:bold; display:block; margin-bottom:.3rem; }
    select, button { width:100%; }
    select { padding:.4rem; border:1px solid #ccc; border-radius:4px;
      max-height:120px; overflow-y:auto; }
    button.btn { background:#28a745; color:#fff; padding:.6rem; border:none;
      border-radius:4px; cursor:pointer; }
    .grid { display:grid; gap:1rem; grid-template-columns:repeat(auto-fill,minmax(200px,1fr)); }
    .card { border:1px solid #ddd; border-radius:8px; overflow:hidden; }
    .card img { width:100%; height:120px; object-fit:cover; }
    .card-content { padding:.5rem; }
    #overlay { display:none; position:fixed; top:0;left:0;width:100%;height:100%;
      background:rgba(0,0,0,0.4); color:#fff;font-size:1.5rem;
      display:flex;align-items:center;justify-content:center;z-index:999; }
  </style>
</head>
<body>
  <div id="overlay">⏳ Cocinando para ti…</div>
  <h1>Sazoom</h1>

  <form id="f">
    <div class="field">
      <label>Ingredientes</label>
      <select id="ings" name="ingredients" multiple>
        {% for ing in all_ingredients %}
          <option value="{{ ing }}">{{ ing }}</option>
        {% endfor %}
      </select>
    </div>
    <div class="field">
      <label>Dieta</label>
      <select id="diet" name="diet">
        <option value="">— ninguna —</option>
        {% for d in all_diets %}
          <option value="{{ d }}">{{ d }}</option>
        {% endfor %}
      </select>
    </div>
    <div class="field">
      <label>Alergenos</label>
      <select id="health" name="health" multiple>
        {% for h in all_health %}
          <option value="{{ h }}">{{ h }}</option>
        {% endfor %}
      </select>
    </div>
    <button type="submit" class="btn">Buscar</button>
  </form>

  <div id="results" class="grid"></div>

  <script>
    const f = document.getElementById('f'),
          overlay = document.getElementById('overlay'),
          results = document.getElementById('results');

    f.addEventListener('submit', async e => {
      e.preventDefault();
      results.innerHTML = '';
      overlay.style.display = 'flex';

      const selI = [...document.getElementById('ings').selectedOptions].map(o=>o.value),
            diet  = document.getElementById('diet').value,
            selH  = [...document.getElementById('health').selectedOptions].map(o=>o.value);

      const params = new URLSearchParams();
      selI.forEach(i=> params.append('ingredients', i));
      if (diet)  params.append('diet', diet);
      selH.forEach(h=> params.append('health', h));
      params.append('number', '12');

      const res = await fetch(`/recipes?${params}`),
            list = await res.json();

      overlay.style.display = 'none';
      results.innerHTML = list.length
        ? list.map(r=>`
            <div class="card">
              <img src="${r.image}" alt="${r.title}"/>
              <div class="card-content">
                <h4>${r.title}</h4>
                <button class="btn" onclick="location.href='/recipe/${r.id}'">
                  Ver receta
                </button>
              </div>
            </div>
          `).join('')
        : '<p>No hay resultados.</p>';
    });
  </script>
</body>
</html>
